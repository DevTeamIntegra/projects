sap.ui.define(["sap/ui/model/json/JSONModel","sap/ui/Device","prestamosgp2/utils/utils","sap/ui/thirdparty/jquery","prestamosgp2/utils/formatter","prestamosgp2/utils/constants"],function(e,a,r,jQuery,o,s){"use strict";return{createDeviceModel:function(){var r=new e(a);r.setDefaultBindingMode("OneWay");return r},getToken:function(e){var a=r.getUrl();var o=this;var s;var t;var n=new FormData;n.append("username","ext2215");n.append("password","ext2215");n.append("grant_type","password");n.append("client_id","PRT");n.append("application","PRT");s=a+"/nassa/oauth/token";const i=n;jQuery.ajax({type:"POST",async:false,url:s,data:i,processData:false,contentType:false,headers:{Authorization:"Basic UFJUOiQ0YSQxMSRja1k0UyRQVkVoL0NaWkp2b0E1WlUuSlhqU05maFlUSmpsbFN1UTRITG41L1diWjE5NEJuVw=="},success:function(a){if(a){var r=a;e(r);setTimeout(function(){o.getToken(e)},parseInt(r.expires_in))}else{e(null)}},error:function(a){e(null)}});return t},getUserInfoAndRole:async function(a){var o=this;var s=window.location.href;var t=s.split("user=");const n=r.getUrl()+"/user-api/attributes";var i=new e;var u={firstname:"Dummy",lastname:"User",email:"dummy.user@com",name:"EXT3512",displayName:"Dummy User (dummy.user@com)"};i.loadData(n);await i.dataLoaded().then(()=>{if(!i.getData().email){i.setData(u)}a.setModel(i,"userInfo");try{a.getModel("userInfo").oData.name}catch(e){a.getModel("userInfo").oData.name}a.user=u}).catch(()=>{a.user=u})},getMoreUserInfo:function(a){var o;a.getModel("userInfo").getProperty("/sub")?o=a.getModel("userInfo").getProperty("/sub")[0]:o=a.user.name;var s=r.getUrl();var t,n;var i=this;var u;t=s+"/odata/v2/User?$filter=username eq 'ICO"+o+"'&$format=json&$expand=empInfo,empInfo/personNav,empInfo/personNav/homeAddressNavDEFLT,empInfo/personNav/nationalIdNav,empInfo/compInfoNav,proxy&$select=userId,firstName,lastName,defaultFullName,empInfo/personNav/homeAddressNavDEFLT,empInfo/personNav/nationalIdNav,empInfo,empInfo/compInfoNav,proxy";jQuery.ajax({type:"GET",async:false,url:t,success:function(a){if(a.d.results.length>0){if(a.d.results.empInfo==null||a.d.results.empInfo==undefined){var o=a.d.results[0];var s=o.lastName+", "+o.firstName;var t=o.userId;var n=o.empInfo.personNav.homeAddressNavDEFLT.results;var i=o.empInfo.personNav.nationalIdNav.results.find(e=>e.cardType=="DNI"&&e.country=="ESP");var c=o.empInfo.compInfoNav.results[0].customDouble1;u=new e({userId:t,name:s,dni:i.nationalId,salario:c,calle:n[0].address1,numero:n[0].address2,escalera:n[0].address3,planta:n[0].customString1,puerta:n[0].customString2,cp:n[0].zipCode,ciudad:n[0].city,provincia:n[0].county,pais:n[0].country})}}else{r.showErrorMsg("No se pudo obtener los datos del usuario")}},error:function(e){r.showErrorMsg("No se pudo acceder a la simulación. UNRECHEABLE.")}});return u},getEmpInfo:function(e,a){var o=r.getUrl();var s,t;s=o+"/odata/v2/EmpEmployment?$filter=userId eq '"+a+"'&$format=json";jQuery.ajax({type:"GET",async:false,url:s,success:function(e){if(e){var a=e.d.results}else{r.showErrorMsg("No se pudo realizar la simulación")}},error:function(e){r.showErrorMsg("No se pudo acceder a la simulación. UNRECHEABLE.")}})},getPrestamosUser:function(e){var a=r.getUrl();var o,s,t=[];var n=0;o=a+"/prestamos-rest/prestamos/sap/consulta-operaciones?NIF="+e.dni;jQuery.ajax({type:"GET",async:false,url:o,headers:{Authorization:"Bearer "+e.oToken},success:function(a){if(a&&a.listaOperaciones.length>0){s=a.listaOperaciones;s.forEach(a=>{n++;a.producto.includes("VIVIENDA")?a.producto="2":a.producto="1";t.push({dni:e.dni,idPrestamo:a.codigoHost,importe:a.importe,estado:a.estado,producto:a.producto,nproducto:"0"+n.toString(),carencia:a.carencia,plazo:a.plazo,vencimiento:a.vencimiento,crecimiento:a.crecimiento,dias:a.dias,tae:a.tae})})}else{r.showErrorMsg("No se han encontrado prestamos para este usuario")}},error:function(e){r.showErrorMsg("No se pudo acceder a la simulación. UNRECHEABLE.")}});return t},getSimulacionVivienda:function(a,o,s){var t=r.getUrl();var n,i;n=t+"/prestamos-rest/prestamos/sap/simulacion-empleados";jQuery.ajax({type:"GET",async:false,url:n,data:a,headers:{Authorization:"Bearer "+o},success:function(e){if(e){a["tae"]=e.tipo;i=e.listaCuotas}else{r.showErrorMsg("No se pudo realizar la simulación")}},error:function(e){r.showErrorMsg("No se pudo acceder a la simulación. UNRECHEABLE.")}});return new e(i)},getSimulacionConsumo:function(a,o,s){var t=r.getUrl();var n,i;n=t+"/prestamos-rest/prestamos/sap/simulacion-empleados";jQuery.ajax({type:"GET",async:false,url:n,data:a,headers:{Authorization:"Bearer "+o},success:function(e){if(e){a["tae"]=e.tipo;i=e.listaCuotas}else{r.showErrorMsg("No se pudo realizar la simulación")}},error:function(e){r.showErrorMsg("No se pudo acceder a la simulación. UNRECHEABLE.")}});return new e(i)},getSimulacionCondiciones:function(a,o,s){var t=r.getUrl();var n,i;n=t+"/prestamos-rest/prestamos/sap/simulacion-empleados";jQuery.ajax({type:"GET",async:false,url:n,data:a,headers:{Authorization:"Bearer "+o},success:function(e){if(e){a["tae"]=e.tipo;i=e.listaCuotas}else{r.showErrorMsg("No se pudo realizar la simulación")}},error:function(e){r.showErrorMsg("No se pudo acceder a la simulación. UNRECHEABLE.")}});return new e(i)},getCuadroByPrestamo:function(a,o){var s=r.getUrl();var t,n;t=s+"/prestamos-rest/prestamos/sap/cuadro-amortizacion?codigoHost="+a;jQuery.ajax({type:"GET",async:false,url:t,headers:{Authorization:"Bearer "+o.oToken},success:function(e){if(e){n=e.cuadroAmortizacion}else{r.showErrorMsg("No se pudo realizar la simulación")}},error:function(e){r.showErrorMsg("No se pudo acceder a la simulación. UNRECHEABLE.")}});return new e(n)},sendToPrint:function(e,a){var o=r.getUrl();var s,t;var n;s=o+"/sap/opu/odata/sap/ZHR_ODATA_CUADRO_PRESTAMO_SRV/empprestSet";jQuery.ajax({type:"POST",async:false,url:s,data:e,dataType:"json",headers:{"x-csrf-token":a,"Content-Type":"application/json",Accept:"application/json"},success:function(e){if(e){console.log("Existe");n=e.d.Base64}else{r.showErrorMsg("No se pudo realizar la simulación")}},error:function(e){r.showErrorMsg("No se pudo acceder a la simulación. UNRECHEABLE.")}});return n},getCsrfToken:function(){var e=r.getUrl();var a;var o;a=e+"/sap/opu/odata/sap/ZHR_ODATA_CUADRO_PRESTAMO_SRV/empprestSet";jQuery.ajax({type:"GET",async:false,url:a,headers:{"x-csrf-token":"fetch"},success:function(e,a,s){if(s){o=s.getResponseHeader("x-csrf-token")}else{r.showErrorMsg("No se pudo realizar la simulación")}},error:function(e){r.showErrorMsg("No se pudo acceder a la simulación. UNRECHEABLE.")}});return o},formatModelToPrint:function(e,a){var s=new Array;var t=o.formatAddressToPrint(e.calle,e.numero,e.planta,e.puerta);var n=e.listaCuotas[0].fecha;n=r.getDate(n);var i=e.listaCuotas[e.listaCuotas.length-1].fecha;i=r.getDate(i);var u=r.getPlazo(n,i);e.listaCuotas.forEach((a,o)=>{s.push({Codigo:e.codigo,Fecha:r.toFormatDatePrint(a.fecha),Dispo:a.disposicion!=null?a.disposicion.toString():a.disposiciones.toString(),CaAmor:a.capAmortizado.toString(),TiInt:a.tipoInteres?a.tipoInteres.toString():a.tae?a.tae.toString():"0.00",Cuota:a.cuotas.toString(),Amort:a.amortizaciones.toString(),Inter:a.intereses.toString(),CaPte:a.capPendiente.toString()})});var c={Codigo:e.codigo,Base64:"",Prestatario:e.name,Dni:e.dni,Tae:e.listaCuotas[1].tipoInteres?e.listaCuotas[1].tipoInteres.toString():e.listaCuotas[1].tae?e.listaCuotas[1].tae.toString():"0.00",Domicilio:t,Poblacion:e.ciudad,Importe:e.importe,Carencia:"0",Cp:e.cp,Plazo:u.toString(),Simul:a,HeaderToItem:s};return JSON.stringify(c)}}});
//# sourceMappingURL=models.js.map